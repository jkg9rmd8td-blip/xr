<div class="bg-slate-900 relative">
  @if (isCameraEnabled()) {
    <video id="cameraFeed" autoplay playsinline class="absolute inset-0 w-full h-full object-cover z-0"></video>
    <div class="absolute inset-0 w-full h-full bg-slate-900/70 z-0"></div>
  }

  <div class="relative z-10">
    <!-- AR Instructions Toast -->
    @if (showEnvironmentInstructions() && activeEnvironment()?.instructions?.length) {
      <div 
        class="fixed top-5 inset-x-0 z-50 flex justify-center transition-opacity duration-300 animate-fade-in"
        [class.opacity-100]="showEnvironmentInstructions()"
        [class.opacity-0]="!showEnvironmentInstructions()">
        <div class="w-full max-w-md mx-4 rounded-lg bg-slate-800/80 p-4 backdrop-blur-sm ring-1 ring-white/10 text-white shadow-2xl">
          <div class="flex items-start gap-4">
            <div class="flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-indigo-400">
                <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="flex-grow text-right">
              <h3 class="font-bold">إرشادات الواقع المعزز: {{ activeEnvironment()?.title }}</h3>
              <ul class="mt-2 text-sm text-gray-300 list-disc pr-4 space-y-1">
                @for(instruction of activeEnvironment()?.instructions; track instruction) {
                  <li>{{ instruction }}</li>
                }
              </ul>
              <div class="mt-3 text-left">
                <button (click)="dismissInstructions()" class="text-xs font-semibold bg-indigo-500/50 text-indigo-200 px-3 py-1 rounded-md hover:bg-indigo-500/70 transition-colors">فهمت</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    }

    <header class="absolute inset-x-0 top-0 z-40">
      <nav class="flex items-center justify-between p-6 lg:px-8" aria-label="Global">
        <div class="flex lg:flex-1">
          <a href="#" (click)="scrollTo('top'); $event.preventDefault()" class="-m-1.5 p-1.5 flex items-center">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCAxMDAgNDAiPjxzY3JpcHQvPjxzdHlsZT4udGV4dCB7IGZvbnQ6IGJvbGQgMzBweCBUYWphd2FsLCBzYW5zLXNlcmlmOyBmaWxsOiB3aGl0ZTsgfS54ciB7IGZpbGw6ICM2MzY2ZjE7IH08L3N0eWxlPjx0ZXh0IHg9IjAiIHk9IjMwIiBjbGFzcz0idGV4dCI+U3BlYWsrc3BhbiBjbGFzcz0ieHIiPlhSPC9zcGFuPjwvdGV4dD48L3N2Zz4=" alt="SpeakXR Logo" class="h-10 w-auto">
          </a>
        </div>
        <div class="hidden lg:flex lg:gap-x-12">
          <a href="#features" (click)="scrollTo('features'); $event.preventDefault()" class="text-sm font-semibold leading-6 text-gray-300 hover:text-white transition-colors">الميزات</a>
          <a href="#analysis" (click)="scrollTo('analysis'); $event.preventDefault()" class="text-sm font-semibold leading-6 text-gray-300 hover:text-white transition-colors">تحليل الأداء</a>
          <a href="#environments" (click)="scrollTo('environments'); $event.preventDefault()" class="text-sm font-semibold leading-6 text-gray-300 hover:text-white transition-colors">بيئات التدريب</a>
          <a href="#value" (click)="scrollTo('value'); $event.preventDefault()" class="text-sm font-semibold leading-6 text-gray-300 hover:text-white transition-colors">قيمتنا</a>
        </div>
        <div class="hidden lg:flex lg:flex-1 lg:justify-end">
        </div>
      </nav>
    </header>

    <main id="top">
      <div class="relative isolate px-6 pt-14 lg:px-8">
        <div class="absolute inset-x-0 -top-40 -z-10 transform-gpu overflow-hidden blur-3xl sm:-top-80" aria-hidden="true">
          <div class="relative left-[calc(50%-11rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 rotate-[30deg] bg-gradient-to-tr from-[#8085ff] to-[#4f46e5] opacity-30 sm:left-[calc(50%-30rem)] sm:w-[72.1875rem]" style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"></div>
        </div>
        <div class="mx-auto max-w-3xl py-32 sm:py-48 lg:py-56 text-center">
          <h1 class="text-4xl font-bold tracking-tight text-white sm:text-6xl">أتقن الخطابة العامة بالذكاء الاصطناعي والواقع الممتد</h1>
          <p class="mt-6 text-lg leading-8 text-gray-300">SpeakXR هي منصة تدريب افتراضية مبتكرة تستخدم الواقع المعزز والذكاء الاصطناعي لتطوير مهاراتك في العرض والتقديم. تدرب بشكل واقعي، واحصل على ملاحظات فورية، وابنِ ثقة لا تتزعزع.</p>
          <div class="mt-10 flex items-center justify-center gap-x-6">
            <a href="#features" (click)="scrollTo('features'); $event.preventDefault()" class="rounded-md bg-indigo-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">اعرف المزيد <span aria-hidden="true">→</span></a>
          </div>
        </div>
        
        <!-- AR HUD Indicators -->
        <div class="absolute bottom-10 inset-x-0 z-10">
          <div class="mx-auto max-w-7xl px-6 lg:px-8">
            <div class="flex items-end justify-between gap-8">
              <!-- Audience Engagement Meter -->
              <div class="w-1/3 max-w-xs space-y-2 rounded-lg bg-black/30 p-3 backdrop-blur-sm ring-1 ring-white/10">
                <div class="flex items-center gap-x-2 text-sm font-medium text-white">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-indigo-400">
                    <path d="M10 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM6 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM1.49 15.326a.78.78 0 0 1-.358-.442 3 3 0 0 1 4.308-3.516a.75.75 0 0 1 .537.838 1.5 1.5 0 0 0 3.024 0 .75.75 0 0 1 .537-.838 3 3 0 0 1 4.308 3.516.78.78 0 0 1-.358.442l-3.235 1.617a.75.75 0 0 1-.698 0l-3.235-1.617ZM14 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z" />
                  </svg>
                  <span>تفاعل الجمهور</span>
                  <span class="ml-auto font-mono tabular-nums">{{ audienceEngagement() }}%</span>
                </div>
                <div class="w-full bg-white/10 rounded-full h-1.5">
                  <div 
                    class="h-1.5 rounded-full transition-all duration-500"
                    [style.width.%]="audienceEngagement()"
                    [class.bg-green-500]="audienceEngagement() > 60"
                    [class.bg-yellow-500]="audienceEngagement() >= 40 && audienceEngagement() <= 60"
                    [class.bg-red-500]="audienceEngagement() < 40"
                  ></div>
                </div>
              </div>

              <!-- Environment Switcher -->
              <div class="flex flex-col items-center gap-2">
                @if(activeEnvironment(); as env) {
                  <span class="text-sm font-medium text-white">{{ env.title }}</span>
                }
                <div class="flex items-center gap-2 rounded-lg bg-black/30 p-2 backdrop-blur-sm ring-1 ring-white/10">
                  @for(env of environments(); track env.title) {
                    <button
                      (click)="setActiveEnvironment(env)"
                      class="p-2 rounded-md transition-colors"
                      [class]="activeEnvironment() === env ? 'bg-indigo-600' : 'bg-slate-700/50 hover:bg-slate-600'"
                      [attr.aria-label]="env.title"
                    >
                      @switch (env.icon) {
                        @case ('newspaper') { <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" /></svg> }
                        @case ('chat-bubble-left-right') { <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193l-3.72-3.72a1.125 1.125 0 00-1.59.028l-2.47 2.47a1.125 1.125 0 01-1.59 0l-2.47-2.47a1.125 1.125 0 00-1.59 0l-3.72 3.72a2.122 2.122 0 01-1.98-2.193v-4.286c0-.97.616-1.813 1.5-2.097M15.75 6.75v3.375c0 .621.504 1.125 1.125 1.125h3.375c.621 0 1.125-.504 1.125-1.125V6.75M15.75 6.75h-3.375a1.125 1.125 0 00-1.125 1.125v3.375c0 .621-.504 1.125-1.125 1.125H6.75M6.75 6.75v3.375c0 .621-.504 1.125-1.125 1.125H2.25V6.75" /></svg> }
                        @case ('microphone') { <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 013-3a3 3 0 013 3v8.25a3 3 0 01-3 3z" /></svg> }
                        @case ('globe-alt') { <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418" /></svg> }
                        @case ('user-group') { <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962c.57-1.023-.194-1.373-1.03-1.373-1.356 0-1.554 1.373-1.03 1.373m1.03-1.373L9 12l-1.03 1.373m1.03-1.373a3.75 3.75 0 10-5.74 2.546M3 18.75a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72M13.5 18.75a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72" /></svg> }
                        @case ('cog') { <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12a7.5 7.5 0 0015 0m-15 0a7.5 7.5 0 1115 0m-15 0H3m18 0h-1.5m-15 0a7.5 7.5 0 1115 0m-15 0H3m18 0h-1.5m-15 0a7.5 7.5 0 1115 0m-15 0H3m18 0h-1.5" /></svg> }
                      }
                    </button>
                  }
                </div>
              </div>

              <!-- Right-side controls wrapper -->
              <div class="flex items-end gap-4">
                  <!-- AI Coach Feedback -->
                  <div class="rounded-lg bg-black/30 p-3 backdrop-blur-sm ring-1 ring-white/10">
                    <div class="flex items-center gap-x-2 text-sm font-medium text-white">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-indigo-400 animate-pulse">
                        <path fill-rule="evenodd" d="M10 2a.75.75 0 0 1 .75.75v1.25a.75.75 0 0 1-1.5 0V2.75A.75.75 0 0 1 10 2ZM5.057 5.057a.75.75 0 0 1 1.06 0l.885.884a.75.75 0 1 1-1.06 1.06l-.884-.885a.75.75 0 0 1 0-1.06ZM14.943 5.057a.75.75 0 0 1 0 1.06l-.884.885a.75.75 0 1 1-1.06-1.06l.884-.884a.75.75 0 0 1 1.06 0ZM5.75 10a.75.75 0 0 1 .75-.75h1.25a.75.75 0 0 1 0 1.5H6.5a.75.75 0 0 1-.75-.75ZM12.25 10a.75.75 0 0 1 .75-.75h1.25a.75.75 0 0 1 0 1.5H13a.75.75 0 0 1-.75-.75ZM8 12.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5H8.75a.75.75 0 0 1-.75-.75ZM10 18a.75.75 0 0 0 0-1.5a4.5 4.5 0 0 0 0-9 .75.75 0 0 0 0-1.5 6 6 0 1 1 0 12Z" clip-rule="evenodd" />
                      </svg>
                      <span>ملاحظات المدرب:</span>
                      <span class="text-gray-200">{{ aiFeedback() }}</span>
                    </div>
                  </div>

                  <!-- Camera Toggle -->
                  <div class="flex flex-col items-center gap-1">
                      <button (click)="toggleCamera()" 
                              [attr.aria-pressed]="isCameraEnabled()"
                              class="p-3 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-indigo-500"
                              [class]="isCameraEnabled() ? 'bg-indigo-600 text-white' : 'bg-black/30 text-gray-300 hover:bg-slate-700 ring-1 ring-white/10 backdrop-blur-sm'">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z" />
                          </svg>
                      </button>
                      @if(cameraError()) {
                        <p class="text-xs text-red-400 max-w-xs text-center bg-black/50 p-1 rounded">{{ cameraError() }}</p>
                      }
                  </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="absolute inset-x-0 top-[calc(100%-13rem)] -z-10 transform-gpu overflow-hidden blur-3xl sm:top-[calc(100%-30rem)]" aria-hidden="true">
          <div class="relative left-[calc(50%+3rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 bg-gradient-to-tr from-[#8085ff] to-[#9333ea] opacity-30 sm:left-[calc(50%+36rem)] sm:w-[72.1875rem]" style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"></div>
        </div>
      </div>

      <div id="features" class="py-24 sm:py-32">
        <div class="mx-auto max-w-7xl px-6 lg:px-8">
          <div class="mx-auto max-w-2xl lg:text-center">
            <h2 class="text-base font-semibold leading-7 text-indigo-400">الميزات الأساسية</h2>
            <p class="mt-2 text-3xl font-bold tracking-tight text-white sm:text-4xl">كل ما تحتاجه لتصبح متحدثًا واثقًا</p>
            <p class="mt-6 text-lg leading-8 text-gray-300">توفر SpeakXR مجموعة شاملة من الأدوات المدعومة بالواقع المعزز والذكاء الاصطناعي لمنحك تدريبًا واقعيًا وملاحظات قابلة للتنفيذ.</p>
          </div>
          <div class="mx-auto mt-16 max-w-2xl sm:mt-20 lg:mt-24 lg:max-w-none">
            <dl class="grid max-w-xl grid-cols-1 gap-x-8 gap-y-10 lg:max-w-none lg:grid-cols-3 lg:gap-y-16">
              @for (feature of features(); track feature.title) {
                <div class="relative p-6 rounded-2xl bg-slate-800/50 ring-1 ring-white/10 transition-transform duration-300 ease-in-out hover:scale-105">
                  <dt class="text-base font-semibold leading-7 text-white pr-14">
                    <div class="absolute right-6 top-6 flex h-10 w-10 items-center justify-center rounded-lg bg-indigo-600">
                      @switch (feature.icon) {
                        @case ('cube-transparent') {
                          <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                        }
                        @case ('chart-bar') {
                          <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" /></svg>
                        }
                        @case ('video-camera') {
                          <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9A2.25 2.25 0 0013.5 5.25h-9A2.25 2.25 0 002.25 7.5v9A2.25 2.25 0 004.5 18.75z" /></svg>
                        }
                        @case ('robot') {
                          <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5M15.75 3v1.5M19.5 8.25h1.5M19.5 12h1.5M19.5 15.75h1.5M15.75 21v-1.5M12 4.5V3m0 18v-1.5" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 100-12 6 6 0 000 12z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5z" /></svg>
                        }
                        @case ('bolt') {
                          <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" /></svg>
                        }
                      }
                    </div>
                    {{ feature.title }}
                  </dt>
                  <dd class="mt-2 text-base leading-7 text-gray-400">{{ feature.description }}</dd>

                  @if (feature.icon === 'robot') {
                    <div class="mt-4 rounded-lg bg-slate-900/70 p-4 ring-1 ring-white/10">
                      <div class="h-64 overflow-y-auto pr-2 space-y-4 mb-4">
                        @for(message of chatMessages(); track $index) {
                          <div class="flex" [class.justify-end]="message.role === 'user'">
                            <div
                              class="max-w-xs md:max-w-md lg:max-w-lg px-4 py-2 rounded-lg"
                              [class.bg-indigo-600]="message.role === 'user'"
                              [class.text-white]="message.role === 'user'"
                              [class.bg-slate-700]="message.role === 'model'"
                              [class.text-gray-200]="message.role === 'model'"
                            >
                              <p class="text-sm">{{ message.text }}</p>
                            </div>
                          </div>
                        }
                        @if (isLoading()) {
                          <div class="flex">
                             <div class="max-w-xs md:max-w-md lg:max-w-lg px-4 py-2 rounded-lg bg-slate-700 text-gray-200">
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <div class="w-2 h-2 rounded-full bg-indigo-400 animate-pulse"></div>
                                    <div class="w-2 h-2 rounded-full bg-indigo-400 animate-pulse [animation-delay:0.2s]"></div>
                                    <div class="w-2 h-2 rounded-full bg-indigo-400 animate-pulse [animation-delay:0.4s]"></div>
                                </div>
                             </div>
                          </div>
                        }
                      </div>

                      <div class="flex items-center justify-between gap-4 mb-3">
                        <div class="flex items-center gap-x-2">
                            <!-- Tone Toggle -->
                            <div class="flex items-center rounded-lg p-1 bg-slate-700/50">
                                <button
                                  (click)="setCoachingTone('encouraging')"
                                  [class]="coachingTone() === 'encouraging' ? 'bg-indigo-600 text-white' : 'text-gray-400 hover:bg-slate-600'"
                                  class="px-3 py-1 text-xs font-medium rounded-md transition-colors"
                                >
                                  مشجع
                                </button>
                                <button
                                  (click)="setCoachingTone('direct')"
                                  [class]="coachingTone() === 'direct' ? 'bg-indigo-600 text-white' : 'text-gray-400 hover:bg-slate-600'"
                                  class="px-3 py-1 text-xs font-medium rounded-md transition-colors"
                                >
                                  مباشر
                                </button>
                            </div>
                             <!-- Speed Toggle -->
                            <div class="flex items-center rounded-lg p-1 bg-slate-700/50">
                                <button
                                  (click)="setResponseSpeed('normal')"
                                  [class]="responseSpeed() === 'normal' ? 'bg-indigo-600 text-white' : 'text-gray-400 hover:bg-slate-600'"
                                  class="px-3 py-1 text-xs font-medium rounded-md transition-colors"
                                >
                                  عادي
                                </button>
                                <button
                                  (click)="setResponseSpeed('fast')"
                                  [class]="responseSpeed() === 'fast' ? 'bg-indigo-600 text-white' : 'text-gray-400 hover:bg-slate-600'"
                                  class="px-3 py-1 text-xs font-medium rounded-md transition-colors"
                                >
                                  سريع
                                </button>
                            </div>
                        </div>
                        <button (click)="clearChat()" class="text-gray-400 hover:text-white transition-colors" aria-label="Clear chat history">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-4.991-2.693L7.985 5.989m0 0A8.25 8.25 0 0119.644 2.985m0 0v4.992m0 0h-4.992" />
                          </svg>
                        </button>
                      </div>
                
                      <form class="flex items-center gap-2" (submit)="sendMessage()">
                        <input
                          type="text"
                          [(ngModel)]="userInput"
                          name="userInput"
                          placeholder="اسأل مدربك..."
                          class="flex-grow bg-slate-700 text-white placeholder-gray-400 rounded-md border-0 py-1.5 px-3 ring-1 ring-inset ring-slate-600 focus:ring-2 focus:ring-inset focus:ring-indigo-500 transition"
                          [disabled]="isLoading()"
                        />
                        <button
                          type="submit"
                          class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:bg-slate-600 disabled:cursor-not-allowed transition"
                          [disabled]="isLoading() || !userInput().trim()"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-5 h-5">
                            <path d="M2.872 7.433l7.934-3.174A.25.25 0 0 1 11 4.5v7a.25.25 0 0 1-.43.193L2.872 8.567a.25.25 0 0 1 0-.134Z" />
                          </svg>
                        </button>
                      </form>
                    </div>
                  }
                </div>
              }
            </dl>
          </div>
        </div>
      </div>

       <!-- Record and Analyze Section -->
      <div id="analysis" class="py-24 sm:py-32 bg-slate-900/50">
        <div class="mx-auto max-w-7xl px-6 lg:px-8">
          <div class="mx-auto max-w-2xl lg:text-center">
            <h2 class="text-base font-semibold leading-7 text-indigo-400">تحليل الأداء الفوري</h2>
            <p class="mt-2 text-3xl font-bold tracking-tight text-white sm:text-4xl">سجل وحلل أداءك</p>
            <p class="mt-6 text-lg leading-8 text-gray-300">استخدم الميكروفون لتسجيل خطابك، وسيقوم الذكاء الاصطناعي بتحليل أدائك وتقديم ملاحظات مفصلة حول سرعة الإلقاء، تنوع طبقة الصوت، والكلمات الحشوية.</p>
          </div>

          <div class="mx-auto mt-16 max-w-3xl">
            <div class="relative rounded-2xl bg-slate-800/50 p-8 ring-1 ring-white/10 text-center">
              @if (analysisResult(); as result) {
                <!-- Results View -->
                <div class="space-y-8">
                  <div>
                      <h3 class="text-lg font-medium text-white">ملخص التحليل</h3>
                      <p class="mt-2 text-gray-300">{{ result.summary }}</p>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-right">
                      <!-- Pace -->
                      <div class="rounded-lg bg-slate-700/50 p-4 ring-1 ring-white/10">
                          <h4 class="font-semibold text-white">سرعة الإلقاء</h4>
                          @let paceInfo = getPaceFeedback(result.pace);
                          <p class="text-sm text-gray-400">{{ paceInfo.label }} ({{ result.pace }} كلمة/دقيقة)</p>
                          <div class="mt-3 w-full bg-slate-600 rounded-full h-2.5">
                              <div class="h-2.5 rounded-full" [class]="paceInfo.color" [style.width.%]="paceInfo.percentage"></div>
                          </div>
                      </div>
                      <!-- Pitch -->
                      <div class="rounded-lg bg-slate-700/50 p-4 ring-1 ring-white/10">
                          <h4 class="font-semibold text-white">تنوع طبقة الصوت</h4>
                          <div class="mt-2 flex items-center justify-center gap-x-2">
                             @if(result.pitchVariation === 'dynamic') {
                                <svg class="w-6 h-6 text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z" /></svg>
                                <span class="text-lg text-white">ديناميكي</span>
                             } @else {
                                <svg class="w-6 h-6 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5" /></svg>
                                <span class="text-lg text-white">رتيب</span>
                             }
                          </div>
                      </div>
                  </div>

                  <!-- Filler Words -->
                  @if (result.fillerWords && result.fillerWords.length > 0) {
                      <div class="rounded-lg bg-slate-700/50 p-4 ring-1 ring-white/10 text-right">
                           <h4 class="font-semibold text-white">الكلمات الحشوية</h4>
                           <div class="mt-2 flex flex-wrap justify-center gap-2">
                              @for(word of result.fillerWords; track word.word) {
                                 <span class="inline-flex items-center rounded-md bg-slate-600 px-2 py-1 text-xs font-medium text-gray-300">{{ word.word }} ({{ word.count }})</span>
                              }
                           </div>
                      </div>
                  } @else {
                     <div class="rounded-lg bg-green-900/50 p-4 ring-1 ring-green-400/20 text-center">
                         <p class="text-green-300 font-medium">عمل رائع! لم يتم اكتشاف أي كلمات حشوية.</p>
                     </div>
                  }

                  <button (click)="recordAgain()" class="rounded-md bg-indigo-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                    سجل مرة أخرى
                  </button>
                </div>
              } @else {
                <!-- Recording View -->
                <div class="flex flex-col items-center justify-center space-y-6 min-h-[20rem]">
                  @if(isAnalyzing()) {
                    <div class="flex flex-col items-center space-y-4 w-full">
                      <p class="text-lg text-gray-300">جارٍ تحليل أدائك...</p>
                      <div class="w-full max-w-sm bg-slate-700 rounded-full h-2.5">
                        <div 
                          class="bg-indigo-500 h-2.5 rounded-full transition-all duration-300" 
                          [style.width.%]="analysisProgress()">
                        </div>
                      </div>
                      <p class="text-sm font-mono tabular-nums text-indigo-300">{{ analysisProgress() }}%</p>
                    </div>
                  } @else {
                    <button (click)="toggleRecording()" 
                            class="relative flex items-center justify-center w-24 h-24 rounded-full transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800"
                            [class]="isRecording() ? 'bg-red-600 hover:bg-red-700 focus:ring-red-500' : 'bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500'">
                        @if (isRecording()) {
                          <div class="absolute inset-0 bg-red-500 rounded-full animate-ping"></div>
                        }
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-10 h-10 text-white">
                          <path d="M8.25 4.5a3.75 3.75 0 117.5 0v8.25a3.75 3.75 0 11-7.5 0V4.5z" />
                          <path d="M6 10.5a.75.75 0 01.75.75v.75a4.5 4.5 0 009 0v-.75a.75.75 0 011.5 0v.75a6 6 0 11-12 0v-.75A.75.75 0 016 10.5z" />
                        </svg>
                    </button>
                    <div class="text-center">
                      <p class="text-lg font-medium text-white">
                        {{ isRecording() ? 'التسجيل قيد التقدم...' : 'اضغط للتسجيل' }}
                      </p>
                      <p class="text-2xl font-mono tabular-nums text-gray-300 mt-1">
                         {{ formatTime(recordingTime()) }}
                      </p>
                    </div>
                  }

                   @if (analysisError()) {
                      <div class="bg-red-900/50 text-red-300 text-sm rounded-md p-3 ring-1 ring-red-500/30">
                          {{ analysisError() }}
                      </div>
                   }
                </div>
              }
            </div>
          </div>
        </div>
      </div>


      <div id="environments" class="py-24 sm:py-32">
          <div class="mx-auto max-w-7xl px-6 lg:px-8">
              <div class="mx-auto max-w-2xl lg:text-center">
                  <h2 class="text-base font-semibold leading-7 text-indigo-400">بيئات التدريب</h2>
                  <p class="mt-2 text-3xl font-bold tracking-tight text-white sm:text-4xl">تدرب في أي سيناريو</p>
                  <p class="mt-6 text-lg leading-8 text-gray-300">تُعدك بيئاتنا القابلة للتخصيص لأي موقف، مما يضمن استعدادك للعالم الحقيقي.</p>
              </div>
              <div class="mx-auto mt-16 grid max-w-2xl grid-cols-1 gap-6 sm:grid-cols-2 lg:mx-0 lg:max-w-none lg:grid-cols-3 lg:gap-8">
                  @for(env of environments(); track env.title) {
                      <div class="flex flex-col rounded-2xl bg-slate-800/50 p-8 ring-1 ring-white/10 transition-transform duration-300 ease-in-out hover:scale-105">
                           <div class="flex items-center gap-x-4">
                              <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-indigo-600">
                                 @switch (env.icon) {
                                      @case ('newspaper') { <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" /></svg> }
                                      @case ('chat-bubble-left-right') { <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193l-3.72-3.72a1.125 1.125 0 00-1.59.028l-2.47 2.47a1.125 1.125 0 01-1.59 0l-2.47-2.47a1.125 1.125 0 00-1.59 0l-3.72 3.72a2.122 2.122 0 01-1.98-2.193v-4.286c0-.97.616-1.813 1.5-2.097M15.75 6.75v3.375c0 .621.504 1.125 1.125 1.125h3.375c.621 0 1.125-.504 1.125-1.125V6.75M15.75 6.75h-3.375a1.125 1.125 0 00-1.125 1.125v3.375c0 .621-.504 1.125-1.125 1.125H6.75M6.75 6.75v3.375c0 .621-.504 1.125-1.125 1.125H2.25V6.75" /></svg> }
                                      @case ('microphone') { <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 013-3a3 3 0 013 3v8.25a3 3 0 01-3 3z" /></svg> }
                                      @case ('globe-alt') { <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418" /></svg> }
                                      @case ('user-group') { <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962c.57-1.023-.194-1.373-1.03-1.373-1.356 0-1.554 1.373-1.03 1.373m1.03-1.373L9 12l-1.03 1.373m1.03-1.373a3.75 3.75 0 10-5.74 2.546M3 18.75a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72M13.5 18.75a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72" /></svg> }
                                      @case ('cog') { <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12a7.5 7.5 0 0015 0m-15 0a7.5 7.5 0 1115 0m-15 0H3m18 0h-1.5m-15 0a7.5 7.5 0 1115 0m-15 0H3m18 0h-1.5m-15 0a7.5 7.5 0 1115 0m-15 0H3m18 0h-1.5" /></svg> }
                                 }
                              </div>
                              <h3 class="text-base font-semibold leading-7 tracking-tight text-white">{{env.title}}</h3>
                          </div>
                          <p class="mt-6 flex-grow text-base leading-7 text-gray-400">{{env.description}}</p>
                          <div class="mt-8">
                             <a href="#" (click)="previewEnvironment(env); $event.preventDefault()" class="inline-flex items-center justify-center w-full rounded-md bg-indigo-500/20 px-3 py-2 text-sm font-medium text-indigo-300 ring-1 ring-inset ring-indigo-500/30 hover:bg-indigo-500/40 hover:text-white transition-colors">
                                <svg class="h-5 w-5 ml-2 -mr-1" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                                <span>معاينة في الواقع المعزز</span>
                              </a>
                          </div>
                      </div>
                  }
              </div>
          </div>
      </div>

      <div id="value" class="relative isolate overflow-hidden px-6 py-24 sm:py-32 lg:px-8">
        <div class="absolute inset-0 -z-10 bg-slate-900/50 backdrop-blur-sm"></div>
        <div class="absolute inset-x-0 -top-40 -z-10 transform-gpu overflow-hidden blur-3xl sm:-top-80" aria-hidden="true">
            <div class="relative left-[calc(50%-11rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 rotate-[30deg] bg-gradient-to-tr from-[#8085ff] to-[#4f46e5] opacity-20 sm:left-[calc(50%-30rem)] sm:w-[72.1875rem]" style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"></div>
        </div>
        <div class="mx-auto max-w-2xl text-center">
          <h2 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">قيمتنا الأساسية</h2>
          <blockquote class="mt-6 text-xl italic leading-8 text-gray-300">
              "نحن نحول تدريب الخطابة العامة من النظرية إلى الممارسة الواقعية، وبناء الثقة قبل المواجهة الحقيقية."
          </blockquote>
        </div>
      </div>
    </main>

    <footer class="bg-slate-900" aria-labelledby="footer-heading">
      <h2 id="footer-heading" class="sr-only">Footer</h2>
      <div class="mx-auto max-w-7xl px-6 pb-8 pt-16 sm:pt-24 lg:px-8 lg:pt-32">
        <div class="mt-16 border-t border-white/10 pt-8 text-center">
          <p class="text-xs leading-5 text-gray-400">&copy; 2024 SpeakXR, Inc. جميع الحقوق محفوظة.</p>
        </div>
      </div>
    </footer>
  </div>
</div>
